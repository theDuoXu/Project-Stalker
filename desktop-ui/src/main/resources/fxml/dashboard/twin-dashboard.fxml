<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="projectstalker.ui.view.dashboard.TwinDashboardController"
            stylesheets="@../../css/dashboard.css">

    <top>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="dashboard-header">
            <padding><Insets top="15" right="20" bottom="15" left="20"/></padding>

            <Button onAction="#onCloseDashboard" styleClass="btn-icon, btn-transparent">
                <graphic><FontIcon iconLiteral="mdi2a-arrow-left" iconSize="24" iconColor="#6c757d"/></graphic>
                <tooltip><Tooltip text="Cerrar proyecto y volver"/></tooltip>
            </Button>

            <Separator orientation="VERTICAL"/>

            <VBox spacing="5">
                <Label fx:id="twinNameLabel" text="Cargando Río..." styleClass="h1"/>
                <Label fx:id="twinDescLabel" text="..." styleClass="text-muted"/>

                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label fx:id="hpcStatusLabel" text="HPC: Inicializando" styleClass="status-badge"/>
                    <Button text="Reconectar" onAction="#reconnectHpc" styleClass="btn-xs, btn-outline"/>
                </HBox>
            </VBox>

            <Region HBox.hgrow="ALWAYS"/>

            <StackPane styleClass="mini-map-container" prefWidth="250" prefHeight="100">
                <fx:include source="../components/leaflet-map.fxml" fx:id="miniMap"/>
                <!-- Capa invisible para detectar clics si queremos expandirlo, aunque el WebView se come los eventos -->
                <Pane onMouseClicked="#expandMap" style="-fx-cursor: hand; -fx-background-color: transparent;" pickOnBounds="false"/>
            </StackPane>
        </HBox>
    </top>

    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="dashboard-tabs">

            <Tab fx:id="hydroTab" text="Hidrodinámica">
                <graphic><FontIcon iconLiteral="mdi2w-water" iconSize="18"/></graphic>
                <fx:include fx:id="hydroView" source="tabs/tab-hydrodynamics.fxml"/>
            </Tab>

            <Tab fx:id="qualityTab" text="Calidad y Transporte">
                <graphic><FontIcon iconLiteral="mdi2f-flask" iconSize="18"/></graphic>
                <fx:include fx:id="qualityView" source="tabs/tab-quality.fxml"/>
            </Tab>

            <Tab fx:id="alertsTab" text="Centro de Alertas">
                <graphic><FontIcon iconLiteral="mdi2a-alert-circle-outline" iconSize="18"/></graphic>
                <fx:include source="tabs/tab-alerts.fxml"/>
            </Tab>

            <Tab fx:id="reportsTab" text="Informes">
                <graphic><FontIcon iconLiteral="mdi2f-file-chart" iconSize="18"/></graphic>
                <fx:include source="tabs/tab-reports.fxml"/>
            </Tab>

        </TabPane>
    </center>
</BorderPane>